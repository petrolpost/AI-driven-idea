# AIå†³ç­–æ¡†æ¶é¡¹ç›® Makefile
# æä¾›ä¾¿æ·çš„å¼€å‘å’Œéƒ¨ç½²å‘½ä»¤

.PHONY: help install install-dev install-full sync clean format lint test test-cov dev start build publish info

# é»˜è®¤ç›®æ ‡
help:
	@echo "AIå†³ç­–æ¡†æ¶é¡¹ç›® - å¯ç”¨å‘½ä»¤:"
	@echo ""
	@echo "å®‰è£…å’Œç¯å¢ƒ:"
	@echo "  install      - å®‰è£…åŸºç¡€ä¾èµ–"
	@echo "  install-dev  - å®‰è£…å¼€å‘ä¾èµ–"
	@echo "  install-full - å®‰è£…å®Œæ•´åŠŸèƒ½ä¾èµ–"
	@echo "  sync         - åŒæ­¥ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬"
	@echo "  clean        - æ¸…ç†ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶"
	@echo ""
	@echo "ä»£ç è´¨é‡:"
	@echo "  format       - æ ¼å¼åŒ–ä»£ç "
	@echo "  lint         - ä»£ç æ£€æŸ¥"
	@echo "  test         - è¿è¡Œæµ‹è¯•"
	@echo "  test-cov     - è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š"
	@echo ""
	@echo "å¼€å‘å’Œéƒ¨ç½²:"
	@echo "  dev          - å¯åŠ¨å¼€å‘æœåŠ¡å™¨"
	@echo "  start        - å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨"
	@echo "  build        - æ„å»ºé¡¹ç›®"
	@echo "  publish      - å‘å¸ƒé¡¹ç›®"
	@echo "  info         - æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯"
	@echo ""

# å®‰è£…åŸºç¡€ä¾èµ–
install:
	@echo "ğŸ“¦ å®‰è£…åŸºç¡€ä¾èµ–..."
	uv sync

# å®‰è£…å¼€å‘ä¾èµ–
install-dev:
	@echo "ğŸ› ï¸ å®‰è£…å¼€å‘ä¾èµ–..."
	uv sync --extra dev

# å®‰è£…å®Œæ•´åŠŸèƒ½ä¾èµ–
install-full:
	@echo "ğŸš€ å®‰è£…å®Œæ•´åŠŸèƒ½ä¾èµ–..."
	uv sync --extra full

# åŒæ­¥ä¾èµ–
sync:
	@echo "ğŸ”„ åŒæ­¥ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬..."
	uv sync --upgrade

# æ¸…ç†ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶..."
	uv cache clean
	rm -rf __pycache__/
	rm -rf .pytest_cache/
	rm -rf .mypy_cache/
	rm -rf htmlcov/
	rm -rf build/
	rm -rf dist/
	rm -rf *.egg-info/
	find . -type f -name "*.pyc" -delete
	find . -type f -name "*.pyo" -delete

# æ ¼å¼åŒ–ä»£ç 
format:
	@echo "âœ¨ æ ¼å¼åŒ–ä»£ç ..."
	uv run black .
	uv run ruff check --fix .

# ä»£ç æ£€æŸ¥
lint:
	@echo "ğŸ” ä»£ç æ£€æŸ¥..."
	uv run ruff check .
	uv run mypy .

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	uv run pytest tests/ -v

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
test-cov:
	@echo "ğŸ“Š è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š..."
	uv run pytest tests/ --cov=ai_decision_framework --cov-report=html --cov-report=term
	@echo "ğŸ“ˆ è¦†ç›–ç‡æŠ¥å‘Šå·²ç”Ÿæˆåˆ° htmlcov/index.html"

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
dev:
	@echo "ğŸš€ å¯åŠ¨å¼€å‘æœåŠ¡å™¨..."
	uv run python run.py --host localhost --port 8000

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
start:
	@echo "ğŸŒ å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨..."
	uv run python run.py --host 0.0.0.0 --port 8000 --workers 4

# æ„å»ºé¡¹ç›®
build:
	@echo "ğŸ”¨ æ„å»ºé¡¹ç›®..."
	uv build

# å‘å¸ƒé¡¹ç›®
publish:
	@echo "ğŸ“¤ å‘å¸ƒé¡¹ç›®..."
	uv publish

# æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
info:
	@echo "â„¹ï¸ é¡¹ç›®ä¿¡æ¯:"
	uv run python run.py --info

# åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ
init-dev: install-dev
	@echo "ğŸ¯ åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ..."
	uv run pre-commit install
	@echo "âœ… å¼€å‘ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ!"

# æ£€æŸ¥é¡¹ç›®å¥åº·çŠ¶æ€
check: format lint test
	@echo "âœ… é¡¹ç›®å¥åº·æ£€æŸ¥å®Œæˆ!"

# å¿«é€Ÿå¯åŠ¨ï¼ˆå®‰è£…ä¾èµ–å¹¶å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼‰
quick-start: install-dev dev

# éƒ¨ç½²å‡†å¤‡ï¼ˆæ£€æŸ¥ã€æµ‹è¯•ã€æ„å»ºï¼‰
deploy-prep: check build
	@echo "ğŸš€ éƒ¨ç½²å‡†å¤‡å®Œæˆ!"